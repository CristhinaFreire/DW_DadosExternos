--drop de segurança para as tabelas temporarias
IF OBJECT_ID('#temp_cidades_sesc', 'U') IS NOT NULL
    DROP TABLE #temp_cidades_sesc;
IF OBJECT_ID('#temp_nascidos_municipio', 'U') IS NOT NULL
    DROP TABLE #temp_nascidos_municipio;
	
	
--tabela temporária com os códigos do IBGE para cada cidade de unidades SESC, extraídas da planilha "\\srv-bi\Fonte_Dados_Externos\NN\UOs Sesc 2024.xlsx"
DROP TABLE #temp_cidades_sesc;
CREATE TABLE #temp_cidades_sesc (
    Cidades VARCHAR(255),
    COD_MUNICIPIO_IBGE INT
);
INSERT INTO #temp_cidades_sesc (Cidades, COD_MUNICIPIO_IBGE)
VALUES
    ('Porto Alegre', 431490),
    ('Alegrete', 430040),
    ('Porto Alegre', 431490),
    ('Bagé', 430160),
    ('Bento Gonçalves', 430210),
    ('Cachoeira Do Sul', 430300),
    ('Cachoeirinha', 170382),
    ('Camaquã', 430350),
    ('Canoas', 430460),
    ('Carazinho', 430470),
    ('Caxias Do Sul', 430510),
    ('Porto Alegre', 431490),
    ('Chuí', 430543),
    ('Porto Alegre', 431490),
    ('Cruz Alta', 430610),
    ('Erechim', 430700),
    ('Farroupilha', 430790),
    ('Frederico Westphalen', 430850),
    ('Gramado', 430910),
    ('Gravataí', 430920),
    ('Ijuí', 431020),
    ('Lajeado', 171200),
    ('Montenegro', 431240),
    ('Porto Alegre', 431490),
    ('Novo Hamburgo', 431340),
    ('Palmeira das Missões', 431370),
    ('Passo Fundo', 431410),
    ('Pelotas', 431440),
    ('Porto Alegre', 431490),
    ('Porto Alegre', 431490),
    ('Rio Grande', 431560),
    ('Santa Cruz Do Sul', 431680),
    ('Santa Maria', 240933),
    ('Santa Rosa', 431720),
    ('Santana Do Livramento', 431710),
    ('Santo Ângelo', 431750),
    ('São Borja', 431800),
    ('São Leopoldo', 431870),
    ('São Luiz Gonzaga', 431890),
    ('Taquara', 432120),
    ('Torres', 432150),
    ('Tramandaí', 432160),
    ('Uruguaiana', 432240),
    ('Venâncio Aires', 432260),
    ('Viamão', 432300);

-- tabela temporária para carregar nascidos nos anos anteriores
CREATE TABLE #temp_nascidos_municipio (
     cod_municipio_ibge INT
    ,nascidos_2009 INT
    ,nascidos_2018 INT
    ,nascidos_2019 INT
    ,nascidos_2020 INT
	,nascidos_2021 INT
    ,poder_aquisitivo_2020 nVARCHAR(10)
	,poder_aquisitivo_2021 nVARCHAR(10)
);

INSERT INTO #temp_nascidos_municipio (cod_municipio_ibge, nascidos_2009, nascidos_2018, nascidos_2019, nascidos_2020, nascidos_2021, poder_aquisitivo_2020, poder_aquisitivo_2021)
VALUES
(4314902,22320,24243,22801,18539,16354,0.627,0.661),
(4301602,1772,1741,1812,1585,1521,0.749,0.77),
(4307005,1421,1883,1891,1663,1585,0.803,0.808),
(4316907,3582,4307,4287,3575,3237,0.71,0.743),
(4304630,955,1040,1001,979,930,0.845,0.846),
(4305108,6278,6165,6136,5798,5417,0.73,0.74),
(4313409,3177,4707,4598,3703,3174,0.771,0.803),
(4311403,849,1348,1408,1260,1246,0.825,0.836),
(4314100,3189,3744,3627,3278,3208,0.768,0.785),
(4316808,1477,1798,1719,1575,1570,0.784,0.797),
(4302105,1325,1621,1649,1572,1605,0.739,0.76),
(4300604,2661,2610,2409,2418,2368,0.8,0.835),
(4303103,1601,1813,1583,1538,1689,0.733,0.775),
(4304606,4388,4242,4040,4119,3992,0.702,0.731),
(4314407,4419,4884,4706,4127,4009,0.766,0.785),
(4317202,899,1237,1283,1094,1065,0.794,0.82),
(4310207,1058,1432,1332,1243,1110,0.801,0.83),
(4312401,896,1427,1402,1085,1034,0.738,0.761),
(4304408,453,588,593,606,561,0.799,0.852),
(4319901,1430,1558,1521,1344,1406,0.853,0.88),
(4321501,544,721,672,612,619,0.818,0.85),
(4309209,3177,2618,2624,2704,2786,0.691,0.725),
(4303004,1074,1093,1140,1134,970,0.851,0.871),
(4317400,629,668,656,579,554,0.827,0.855),
(4304705,823,822,854,827,846,0.811,0.841),
(4321204,581,602,534,492,505,0.813,0.881),
(4322400,2046,1820,1790,1626,1620,0.806,0.824),
(4306106,999,910,857,818,838,0.82,0.829),
(4307807,460,660,584,533,535,0.832,0.866),
(4315602,2588,2795,2607,2425,2314,0.663,0.723),
(4317103,1113,1111,1050,1021,950,0.847,0.884),
(4318705,2837,2132,2018,2430,2606,0.737,0.743),
(4317301,342,421,394,381,343,0.805,0.822),
(4317509,1016,1152,1228,1095,1062,0.812,0.835),
(4320008,1678,1420,1278,1461,1379,0.7,0.725),
(4310801,345,290,190,290,236,0.829,0.838),
(4307708,1047,852,848,877,795,0.731,0.776),
(4303509,1124,1171,1088,995,821,0.845,0.851),
(4311809,496,572,520,606,600,0.819,0.838),
(4323002,2320,1774,1583,1975,1898,0.777,0.812),
(4322509,978,1069,1116,1104,1048,0.85,0.852),
(4321600,687,1212,1096,1093,989,0.846,0.875),
(4309100,542,712,728,685,561,0.784,0.766),
(4321451,370,541,505,489,491,0.811,0.837),
(4322608,758,820,811,776,677,0.819,0.813),
(4313508,515,705,560,602,549,0.792,0.815),
(4318002,869,804,859,779,755,0.853,0.844),
(4304200,326,332,332,323,308,0.844,0.904),
(4300406,1001,1054,936,866,916,0.778,0.818),
(4321808,308,314,317,320,297,0.817,0.835),
(4308607,320,445,439,447,466,0.805,0.809),
(4301008,237,365,314,342,342,0.869,0.883),
(4318903,512,533,602,547,505,0.845,0.872),
(4320107,294,360,384,358,362,0.853,0.872),
(4322806,239,289,289,277,270,0.832,0.836),
(4322707,256,257,224,247,257,0.828,0.869),
(4303905,822,704,588,735,691,0.811,0.85),
(4308102,236,259,208,272,253,0.868,0.864),
(4321907,290,368,352,365,318,0.822,0.856),
(4307609,541,473,379,416,454,0.819,0.842),
(4308508,390,486,499,476,463,0.872,0.89),
(4304804,220,348,331,316,343,0.703,0.706),
(4306403,358,329,278,411,353,0.813,0.833),
(4313300,305,347,313,345,275,0.817,0.823),
(4315800,91,105,101,95,85,0.801,0.872),
(4313904,528,559,543,570,524,0.79,0.789),
(4316006,277,292,272,301,275,0.792,0.885),
(4317806,239,392,364,354,384,0.858,0.869),
(4309605,198,198,234,212,224,0.739,0.722),
(4312708,243,384,322,345,333,0.883,0.897),
(4313706,661,643,630,618,645,0.825,0.833),
(4307906,739,860,757,809,766,0.795,0.797),
(4318309,783,772,751,730,656,0.848,0.849),
(4318804,489,473,406,447,368,0.853,0.857),
(4318408,286,319,351,320,261,0.792,0.819),
(4320909,250,401,370,354,386,0.861,0.873),
(4305207,154,186,135,173,176,0.848,0.854),
(4306809,225,297,342,343,283,0.847,0.869),
(4312658,177,211,236,255,242,0.766,0.781),
(4310009,226,242,262,248,243,0.835,0.839),
(4300703,42,54,53,51,37,0.855,0.866),
(4312807,31,67,71,100,77,0.851,0.868),
(4320800,371,440,457,401,399,0.848,0.884),
(4308904,206,210,175,175,217,0.842,0.872),
(4302808,372,410,378,351,372,0.848,0.853),
(4301206,182,184,147,163,163,0.886,0.919),
(4309407,265,323,344,355,325,0.868,0.873),
(4316402,437,501,521,465,500,0.844,0.868),
(4311304,340,398,376,399,382,0.841,0.879),
(4310108,506,475,487,595,537,0.796,0.837),
(4315701,337,343,352,355,333,0.746,0.845),
(4304507,585,527,478,521,534,0.849,0.873),
(4314209,128,90,84,109,112,0.855,0.897),
(4308201,294,418,349,367,372,0.822,0.803),
(4310603,614,537,469,469,466,0.842,0.848),
(4306601,486,433,377,392,355,0.869,0.863),
(4317608,369,349,371,418,423,0.82,0.863),
(4314803,352,271,215,355,387,0.79,0.798),
(4309308,1018,651,688,875,947,0.708,0.717),
(4311205,272,186,170,191,203,0.848,0.841),
(4321303,285,194,166,228,229,0.837,0.82),
(4300802,139,137,133,162,142,0.859,0.847),
(4319604,298,182,166,208,214,0.869,0.877),
(4301107,167,135,138,163,138,0.831,0.86),
(4311007,367,278,302,313,288,0.865,0.873),
(4320404,164,163,183,209,178,0.857,0.874),
(4313201,172,206,192,227,218,0.827,0.831),
(4306767,382,243,271,437,472,0.703,0.706),
(4322202,324,265,224,223,222,0.857,0.879),
(4303301,71,58,69,58,64,0.779,0.7),
(4305355,377,305,260,265,294,0.729,0.766),
(4319000,225,219,226,224,215,0.828,0.825),
(4301909,112,87,121,127,148,0.869,0.893),
(4302709,240,224,199,185,182,0.799,0.841),
(4309001,257,129,138,177,162,0.749,0.828),
(4301503,60,52,40,54,67,0.833,0.886),
(4313805,139,133,96,103,129,0.832,0.872),
(4315305,337,263,249,279,272,0.885,0.887),
(4307500,233,195,190,197,201,0.828,0.857),
(4301305,198,187,145,150,164,0.822,0.841),
(4320206,165,323,358,339,394,0.868,0.886),
(4315909,177,134,119,152,132,0.914,0.929),
(4306908,277,267,248,232,247,0.892,0.868),
(4321402,298,366,370,347,377,0.865,0.866),
(4321006,145,107,94,114,103,0.831,0.847),
(4316600,175,185,164,173,187,0.875,0.891),
(4302907,117,72,71,95,107,0.876,0.884),
(4318507,270,144,157,246,226,0.79,0.747),
(4300208,82,74,39,54,52,0.869,0.879),
(4318200,285,226,247,217,239,0.882,0.884),
(4301404,147,96,88,126,134,0.878,0.901),
(4320701,208,237,247,236,217,0.887,0.92),
(4310504,104,88,65,76,75,0.883,0.921),
(4316709,122,91,92,100,89,0.827,0.832),
(4317707,128,98,91,114,110,0.892,0.905),
(4302303,195,182,144,157,128,0.887,0.9),
(4307302,117,69,75,64,73,0.902,0.901),
(4301750,69,57,36,52,45,0.868,0.894),
(4321105,73,64,72,120,128,0.87,0.891),
(4300505,81,70,37,67,49,0.773,0.783),
(4320503,37,36,41,48,50,0.831,0.79),
(4302402,155,135,133,163,148,0.841,0.885),
(4305306,78,80,76,88,75,0.889,0.891),
(4322004,385,233,210,233,267,0.604,0.676),
(4300455,20,36,36,24,29,0.847,0.869),
(4304903,99,106,100,99,83,0.866,0.867),
(4305900,99,68,58,55,59,0.896,0.899),
(4314605,179,156,87,129,123,0.862,0.869),
(4306007,113,134,135,124,122,0.891,0.898),
(4305801,149,157,181,155,138,0.871,0.897),
(4301701,40,23,28,37,41,0.886,0.894),
(4310850,56,24,18,35,39,0.867,0.895),
(4316303,68,42,57,58,52,0.851,0.894),
(4309902,50,60,64,59,57,0.816,0.817),
(4305504,36,22,23,37,40,0.904,0.888),
(4310405,40,62,49,49,75,0.844,0.833),
(4323200,18,35,25,21,12,0.843,0.878),
(4321436,84,115,107,139,142,0.884,0.904),
(4306304,62,32,27,32,32,0.847,0.886),
(4312906,85,83,72,75,74,0.79,0.812),
(4309506,102,76,71,73,84,0.806,0.875),
(4304689,97,60,59,102,108,0.892,0.896),
(4319158,102,73,65,72,61,0.85,0.878),
(4302600,50,26,33,34,37,0.904,0.916),
(4321667,98,114,106,116,116,0.838,0.902),
(4319109,55,27,23,31,30,0.882,0.908),
(4320552,60,35,30,45,48,0.852,0.823),
(4302204,84,117,112,112,110,0.885,0.918),
(4309704,37,35,44,36,34,0.889,0.887),
(4315404,195,173,167,177,168,0.896,0.841),
(4319505,321,187,165,257,276,0.847,0.868),
(4308805,84,66,86,87,68,0.87,0.888),
(4303608,78,65,70,69,67,0.851,0.871),
(4304663,161,75,69,150,125,0.781,0.818),
(4308706,48,9,11,32,36,0.852,0.86),
(4304002,72,36,23,33,39,0.808,0.835),
(4315107,146,124,120,120,95,0.858,0.874),
(4311155,100,74,52,57,50,0.816,0.837),
(4319802,83,59,60,67,57,0.873,0.896),
(4302501,56,49,42,56,48,0.911,0.915),
(4314506,149,90,84,96,90,0.811,0.84),
(4305454,238,181,184,229,213,0.893,0.913),
(4314050,778,746,698,733,708,0.801,0.854),
(4313060,0,63,97,150,127,0.864,0.904),
(4321709,341,280,278,266,220,0.827,0.864),
(4319406,211,110,126,195,162,0.888,0.909),
(4314704,154,145,98,124,129,0.879,0.903),
(4317905,147,184,166,138,155,0.885,0.897),
(4322103,78,69,37,74,69,0.852,0.884),
(4315503,168,122,103,131,151,0.809,0.883),
(4310538,32,24,22,41,41,0.825,0.8),
(4300109,143,142,129,168,135,0.882,0.84),
(4310330,201,144,140,171,168,0.848,0.867),
(4313375,260,145,137,261,357,0.748,0.768),
(4318606,104,99,62,59,50,0.873,0.892),
(4306502,145,64,66,87,111,0.878,0.891),
(4323804,0,116,101,135,164,0.828,0.826),
(4316451,189,146,126,133,88,0.805,0.89),
(4304358,94,72,68,78,87,0.569,0.567),
(4305439,35,11,11,9,5,0.831,0.873),
(4303806,51,17,22,36,48,0.832,0.847),
(4316105,173,190,189,189,205,0.871,0.875),
(4311759,88,27,23,39,37,0.876,0.883),
(4309050,72,37,33,46,53,0.648,0.813),
(4309803,35,43,47,47,46,0.902,0.896),
(4311106,116,66,55,83,84,0.847,0.882),
(4302352,127,121,152,128,156,0.894,0.894),
(4316956,26,31,20,37,43,0.908,0.927),
(4314076,75,55,53,51,56,0.734,0.876),
(4301651,27,54,40,30,44,0.826,0.832),
(4313037,48,37,35,47,39,0.832,0.873),
(4307104,72,50,54,50,61,0.906,0.94),
(4300646,75,52,66,68,56,0.82,0.92),
(4322301,91,84,77,96,96,0.82,0.817),
(4311700,45,65,54,52,57,0.868,0.888),
(4314001,68,80,70,88,72,0.86,0.872),
(4312609,56,61,44,53,39,0.889,0.897),
(4321352,41,43,44,52,40,0.911,0.916),
(4316501,104,75,50,89,99,0.849,0.842),
(4311122,63,35,42,46,50,0.887,0.893),
(4310306,42,40,40,43,38,0.904,0.924),
(4304952,32,56,42,40,40,0.873,0.886),
(4318051,30,24,41,40,47,0.826,0.873),
(4323408,31,30,36,44,33,0.88,0.89),
(4306452,39,33,42,35,33,0.824,0.813),
(4313656,164,141,147,158,157,0.86,0.86),
(4318424,31,46,33,42,27,0.808,0.909),
(4306932,113,120,91,125,93,0.83,0.846),
(4314308,44,26,34,37,35,0.89,0.879),
(4313953,98,114,109,103,96,0.831,0.842),
(4306734,49,33,34,36,25,0.829,0.818),
(4313102,76,46,60,79,55,0.832,0.876),
(4308003,78,58,66,73,85,0.86,0.871),
(4316204,51,54,41,63,35,0.858,0.858),
(4312252,87,96,90,82,69,0.89,0.891),
(4318440,34,32,40,28,24,0.845,0.876),
(4315008,43,36,30,34,33,0.879,0.883),
(4320677,128,89,93,96,87,0.839,0.902),
(4301057,70,108,75,113,102,0.838,0.896),
(4313003,27,35,31,30,29,0.861,0.872),
(4301800,53,30,53,37,57,0.844,0.85),
(4307401,49,40,29,30,40,0.749,0.809),
(4312203,42,45,41,47,31,0.885,0.916),
(4321956,93,61,76,69,78,0.855,0.896),
(4304101,11,34,20,37,38,0.891,0.914),
(4322533,87,79,85,85,100,0.807,0.828),
(4306056,71,73,65,74,83,0.879,0.865),
(4312500,117,92,120,150,145,0.891,0.913),
(4314423,40,41,45,36,40,0.871,0.869),
(4311601,100,74,56,50,63,0.89,0.893),
(4305959,16,25,24,29,18,0.866,0.842),
(4305702,70,64,60,72,67,0.827,0.838),
(4302659,50,22,28,49,70,0.829,0.884),
(4307559,60,55,52,50,41,0.809,0.812),
(4323309,25,30,24,27,21,0.836,0.823),
(4313607,29,29,20,31,29,0.89,0.915),
(4303558,12,28,38,38,27,0.861,0.843),
(4315131,16,20,23,27,25,0.905,0.931),
(4320230,24,24,24,25,21,0.831,0.872),
(4310652,19,25,24,25,37,0.889,0.869),
(4317954,0,12,21,27,34,0.831,0.894),
(4305009,94,67,59,84,80,0.885,0.885),
(4319703,85,27,32,38,41,0.874,0.882),
(4320305,44,62,42,50,44,0.843,0.855),
(4308458,42,39,47,43,45,0.874,0.889),
(4309654,84,31,46,44,50,0.762,0.825),
(4307831,0,17,23,22,16,0.812,0.81),
(4312054,40,22,12,33,34,0.894,0.906),
(4304309,53,58,59,52,63,0.865,0.877),
(4318101,183,108,119,124,115,0.864,0.879),
(4311502,88,45,67,65,56,0.891,0.895),
(4308409,47,43,47,63,68,0.907,0.929),
(4313359,27,26,15,29,28,0.801,0.812),
(4305173,39,49,61,68,80,0.885,0.91),
(4300034,74,65,46,40,55,0.821,0.829),
(4312757,23,37,34,30,35,0.773,0.758),
(4307450,38,31,24,40,26,0.771,0.821),
(4320263,113,76,59,68,77,0.841,0.874),
(4303202,49,59,54,51,49,0.922,0.907),
(4323101,69,64,62,42,62,0.679,0.79),
(4319208,67,48,44,60,63,0.834,0.873),
(4312153,29,29,27,35,39,0.82,0.901),
(4301552,15,9,17,24,28,0.885,0.877),
(4303707,32,45,38,62,57,0.88,0.904),
(4303400,60,37,38,42,36,0.696,0.708),
(4305405,39,41,41,39,28,0.88,0.893),
(4315206,32,33,26,33,20,0.877,0.898),
(4313086,11,18,22,17,17,0.729,0.765),
(4310439,58,48,51,46,53,0.848,0.838),
(4312302,47,47,49,47,34,0.796,0.899),
(4319372,19,26,32,24,25,0.86,0.874),
(4315156,89,42,50,43,50,0.852,0.894),
(4305587,10,16,13,24,15,0.849,0.872),
(4319307,60,42,32,41,54,0.875,0.908),
(4302006,114,79,60,102,94,0.801,0.889),
(4305371,71,26,27,27,27,0.861,0.863),
(4300554,1,13,16,20,17,0.853,0.877),
(4315453,12,15,21,15,14,0.886,0.888),
(4309555,31,27,37,52,68,0.862,0.878),
(4312443,36,33,27,44,47,0.868,0.815),
(4317004,71,48,59,47,53,0.926,0.913),
(4304713,69,43,63,58,62,0.802,0.901),
(4302584,11,15,14,20,13,0.745,0.734),
(4320453,25,8,13,21,19,0.88,0.895),
(4300059,26,36,45,22,41,0.802,0.812),
(4321477,62,39,56,44,49,0.844,0.848),
(4316758,40,31,30,53,43,0.902,0.923),
(4311254,70,39,45,54,62,0.885,0.92),
(4306973,15,22,29,37,25,0.823,0.79),
(4300307,69,35,37,45,48,0.853,0.879),
(4300638,29,39,45,37,45,0.948,0.841),
(4311981,25,33,36,45,35,0.876,0.876),
(4319125,19,14,14,18,20,0.851,0.867),
(4318499,15,21,14,18,14,0.835,0.843),
(4310413,33,9,16,16,7,0.831,0.792),
(4306700,46,28,26,21,22,0.885,0.89),
(4300901,55,23,38,40,48,0.738,0.773),
(4315354,44,38,37,41,36,0.828,0.845),
(4322905,45,16,12,19,27,0.817,0.887),
(4305603,24,23,28,18,25,0.802,0.851),
(4321832,25,28,25,36,34,0.865,0.835),
(4322251,47,41,43,47,56,0.88,0.87),
(4314159,62,41,45,45,64,0.842,0.918),
(4305132,45,22,18,41,52,0.811,0.859),
(4302451,130,97,101,72,79,0.875,0.905),
(4310363,20,17,22,21,16,0.787,0.772),
(4322152,68,48,51,62,43,0.887,0.923),
(4307203,46,21,27,29,39,0.893,0.904),
(4312351,16,13,16,12,14,0.77,0.823),
(4307864,17,20,13,15,13,0.788,0.873),
(4323457,32,15,15,13,26,0.869,0.902),
(4318465,13,12,13,15,24,0.847,0.852),
(4314027,68,52,41,56,67,0.808,0.805),
(4312450,52,36,34,35,30,0.921,0.942),
(4311130,36,14,21,34,25,0.885,0.891),
(4312104,62,38,23,31,33,0.896,0.888),
(4314753,20,9,10,17,13,0.901,0.912),
(4306205,98,80,58,115,89,0.853,0.849),
(4320859,45,29,24,52,51,0.94,0.932),
(4320651,26,12,9,16,18,0.812,0.842),
(4309753,51,39,35,27,36,0.883,0.9),
(4309951,39,26,23,26,34,0.823,0.894),
(4312385,10,19,13,10,11,0.747,0.751),
(4311775,74,84,56,68,71,0.878,0.911),
(4314548,0,17,20,25,26,0.837,0.85),
(4320354,12,27,13,31,38,0.908,0.906),
(4310553,35,24,20,13,25,0.898,0.878),
(4301875,42,13,11,22,24,0.874,0.921),
(4312005,11,1,10,12,11,0.908,0.88),
(4300851,0,4,16,16,19,0.889,0.867),
(4308300,119,85,47,68,91,0.766,0.872),
(4314068,57,24,21,31,31,0.732,0.596),
(4321469,0,0,5,35,28,0.846,0.867),
(4310751,14,8,12,8,14,0.771,0.78),
(4321634,11,3,7,13,6,0.857,0.899),
(4310900,23,10,13,23,26,0.849,0.867),
(4311908,42,12,11,22,27,0.853,0.87),
(4320602,37,12,13,19,16,0.892,0.896),
(4306379,22,14,10,14,26,0.738,0.839),
(4310462,10,3,10,6,8,0.764,0.821),
(4306353,14,13,13,15,25,0.821,0.851),
(4307054,15,16,9,18,21,0.931,0.932),
(4318622,0,0,0,38,49,0.902,0.865),
(4312427,27,16,11,14,24,0.819,0.867),
(4314472,49,24,16,15,26,0.811,0.842),
(4300661,6,12,6,6,14,0.842,0.816),
(4314555,15,12,14,14,15,0.848,0.857),
(4317251,1,6,6,5,6,0.801,0.787),
(4310702,17,7,3,4,11,0.911,0.886),
(4300877,0,0,0,0,0,0.827,0.88),
(4312476,0,0,0,0,0,0.857,0.886),
(4323770,0,0,0,0,0,0.884,0.894),
(4300471,0,0,0,0,0,0.85,0.863),
(4301636,0,0,0,0,0,0.878,0.904),
(4304655,0,0,0,0,0,0.777,0.806),
(4305116,0,0,0,0,0,0.881,0.816),
(4306551,0,0,0,0,0,0.871,0.894),
(4311270,0,0,0,0,0,0.804,0.854),
(4311718,0,0,0,0,0,0.848,0.843),
(4311791,0,0,0,0,0,0.566,0.806),
(4312617,0,0,0,0,0,0.842,0.792),
(4315057,0,0,0,0,0,0.819,0.806),
(4315172,0,0,0,0,0,0.836,0.864),
(4315552,0,0,0,0,0,0.889,0.906),
(4316428,0,0,0,0,0,0.898,0.911),
(4316733,0,0,0,0,0,0.722,0.853),
(4318432,0,0,0,0,0,0.868,0.86),
(4319752,0,0,0,0,0,0.856,0.834),
(4321329,0,0,0,0,0,0.899,0.893),
(4322327,0,0,0,0,0,0.897,0.898),
(4323358,0,0,0,0,0,0.795,0.869),
(4305934,0,0,0,0,0,0.702,0.75),
(4323606,0,0,0,0,0,0.735,0.768),
(4304622,0,0,0,0,0,0.753,0.756),
(4301925,0,0,0,0,0,0.764,0.767),
(4306924,0,0,0,0,0,0.772,0.791),
(4308656,0,0,0,0,0,0.757,0.808),
(4315073,0,0,0,0,0,0.684,0.767),
(4314464,0,0,0,0,0,0.78,0.781),
(4322343,0,0,0,0,0,0.819,0.77),
(4312674,0,0,0,0,0,0.787,0.822),
(4309126,0,0,0,0,0,0.818,0.803),
(4309571,0,0,0,0,0,0.826,0.758),
(4305835,0,0,0,0,0,0.736,0.786),
(4305871,0,0,0,0,0,0.768,0.809),
(4313334,0,0,0,0,0,0.772,0.797),
(4320578,0,0,0,0,0,0.776,0.821),
(4315958,0,0,0,0,0,0.825,0.817),
(4315321,0,0,0,0,0,0.828,0.833),
(4305975,0,0,0,0,0,0.772,0.809),
(4320321,0,0,0,0,0,0.793,0.82),
(4302220,0,0,0,0,0,0.836,0.841),
(4304614,0,0,0,0,0,0.88,0.865),
(4316477,0,0,0,0,0,0.839,0.821),
(4306130,0,0,0,0,0,0.846,0.868),
(4306320,0,0,0,0,0,0.829,0.817),
(4317756,0,0,0,0,0,0.816,0.85),
(4322186,0,0,0,0,0,0.84,0.865),
(4307815,0,0,0,0,0,0.808,0.843),
(4309159,0,0,0,0,0,0.865,0.693),
(4318457,0,0,0,0,0,0.874,0.861),
(4314779,0,0,0,0,0,0.828,0.773),
(4322855,0,0,0,0,0,0.856,0.864),
(4302253,0,0,0,0,0,0.843,0.852),
(4322350,0,0,0,0,0,0.847,0.858),
(4302154,0,0,0,0,0,0.841,0.872),
(4316436,0,0,0,0,0,0.857,0.852),
(4314134,0,0,0,0,0,0.837,0.843),
(4313011,0,0,0,0,0,0.855,0.845),
(4305447,0,0,0,0,0,0.835,0.868),
(4312179,0,0,0,0,0,0.84,0.811),
(4312955,0,0,0,0,0,0.86,0.866),
(4314456,0,0,0,0,0,0.892,0.842),
(4302238,0,0,0,0,0,0.845,0.842),
(4321493,0,0,0,0,0,0.831,0.874),
(4305850,0,0,0,0,0,0.844,0.861),
(4304671,0,0,0,0,0,0.865,0.832),
(4322525,0,0,0,0,0,0.83,0.858),
(4313425,0,0,0,0,0,0.837,0.879),
(4319737,0,0,0,0,0,0.866,0.867),
(4302378,0,0,0,0,0,0.862,0.829),
(4310579,0,0,0,0,0,0.859,0.865),
(4306429,0,0,0,0,0,0.878,0.864),
(4311239,0,0,0,0,0,0.925,0.881),
(4301958,0,0,0,0,0,0.808,0.825),
(4312625,0,0,0,0,0,0.865,0.89),
(4323507,0,0,0,0,0,0.885,0.883),
(4303673,0,0,0,0,0,0.845,0.859),
(4311643,0,0,0,0,0,0.772,0.899),
(4312138,0,0,0,0,0,0.848,0.886),
(4314787,0,0,0,0,0,0.868,0.887),
(4311627,0,0,0,0,0,0.876,0.864),
(4315313,0,0,0,0,0,0.769,0.853),
(4319364,0,0,0,0,0,0.885,0.901),
(4317558,0,0,0,0,0,0.888,0.884),
(4322376,0,0,0,0,0,0.859,0.882),
(4310876,0,0,0,0,0,0.846,0.918),
(4300570,0,0,0,0,0,0.907,0.903),
(4322541,0,0,0,0,0,0.875,0.886),
(4323754,0,0,0,0,0,0.892,0.91),
(4305157,0,0,0,0,0,0.721,0.872),
(4313441,0,0,0,0,0,0.892,0.909),
(4313391,0,0,0,0,0,0.87,0.896),
(4306957,0,0,0,0,0,0.899,0.878),
(4304853,0,0,0,0,0,0.864,0.891),
(4318614,0,0,0,0,0,0.897,0.891),
(4308250,0,0,0,0,0,0.914,0.911),
(4319711,0,0,0,0,0,0.868,0.873),
(4321857,0,0,0,0,0,0.858,0.894),
(4319356,0,0,0,0,0,0.838,0.901),
(4309258,0,0,0,0,0,0.775,0.846),
(4308078,0,0,0,0,0,0.837,0.892),
(4308854,0,0,0,0,0,0.879,0.887),
(4316972,0,0,0,0,0,0.861,0.907),
(4304697,0,0,0,0,0,0.808,0.853),
(4308052,0,0,0,0,0,0.899,0.912),
(4301073,0,0,0,0,0,0.878,0.933),
(4313466,0,0,0,0,0,0.789,0.747),
(4312377,0,0,0,0,0,0.925,0.887),
(4313490,0,0,0,0,0,0.867,0.771),
(4323705,0,0,0,0,0,0.896,0.925),
(4306072,0,0,0,0,0,0.912,0.922),
(4318481,0,0,0,0,0,0.895,0.895),
(4314175,0,0,0,0,0,0.893,0.844),
(4315149,0,0,0,0,0,0.914,0.922),
(4305124,0,0,0,0,0,0.892,0.89),
(4306759,0,0,0,0,0,0.874,0.934),
(4314035,0,0,0,0,0,0.882,0.916),
(4301859,0,0,0,0,0,0.927,0.922),
(4302055,0,0,0,0,0,0.933,0.883),
(4311429,0,0,0,0,0,0.888,0.938),
(4315750,0,0,0,0,0,0.8,0.893),
(4311734,0,0,0,0,0,0.885,0.846),
(4308433,0,0,0,0,0,0.87,0.874),
(4322558,0,0,0,0,0,0.916,0.874),
(4314498,0,0,0,0,0,0.925,0.943),
(4321626,0,0,0,0,0,0.909,0.923)


-- criação da tabela de geografia final
IF OBJECT_ID('IBGE_DimGeografia', 'U') IS NOT NULL
    DROP TABLE IBGE_DimGeografia;

CREATE TABLE IBGE_DimGeografia (
     COD_MUNICIPIO_TOM INT
    ,COD_MUNICIPIO_IBGE INT
    ,COD_ESTADO_IBGE INT
    ,ESTADO VARCHAR(255)
    ,REGIAO_BRASIL VARCHAR(255)
    ,MUNICIPIO VARCHAR(255)
    ,QUANTIDADE_MUNICIPIOS INTs
    ,UF VARCHAR(2)
    ,COD_MUNICIPIO_CAGED INT
    ,TEM_UNIDADE_SENAC VARCHAR(3)
    ,TEM_UNIDADE_SESC VARCHAR(3)
    ,nascidos_2009 INT
    ,nascidos_2018 INT
    ,nascidos_2019 INT
    ,nascidos_2020 INT
	,nascidos_2021 INT
    ,poder_aquisitivo_2020 NVARCHAR(10)
	,poder_aquisitivo_2021 NVARCHAR(10)
);
INSERT INTO IBGE_DimGeografia
SELECT DISTINCT
     dg.[COD_MUNICIPIO_TOM]
    ,dg.[COD_MUNICIPIO_IBGE]
    ,dg.[COD_ESTADO_IBGE]
    ,dg.[ESTADO]
    ,dg.[REGIAO] as 'REGIAO_BRASIL'
    ,dg.[MUNICIPIO]
    ,dg.[QUANTIDADE_MUNICIPIOS]
    ,dg.[UF]
    ,dg.[COD_MUNICIPIO_CAGED]
    ,CASE
		WHEN du.UNIDADE LIKE '%SESC%SENAC' or du.UNIDADE LIKE '%SENAC%SESC'  THEN 'Sim'
		WHEN du.UNIDADE LIKE '%SENAC%' THEN 'Sim'
        WHEN du.[CODIGOIBGE] IS NOT NULL THEN 'Sim'
        ELSE ISNULL(CAST(du.[CODIGOIBGE] AS NVARCHAR), 'Não')
	 END AS TEM_UNIDADE_SENAC
    ,CASE
		WHEN du.UNIDADE LIKE '%SESC%SENAC' or du.UNIDADE LIKE '%SENAC%SESC'  THEN 'Sim'
        WHEN du.UNIDADE LIKE '%SESC%' OR du.UNIDADE LIKE '%SESQUINHO%' THEN 'Sim'
        WHEN ts.COD_MUNICIPIO_IBGE IS NOT NULL THEN 'Sim'
		WHEN du.[CODIGOIBGE] IS NOT NULL THEN 'Sim'
        ELSE ISNULL(CAST(du.[CODIGOIBGE] AS NVARCHAR), 'Não')
     END AS TEM_UNIDADE_SESC
    ,nsc.nascidos_2009
    ,nsc.nascidos_2018
    ,nsc.nascidos_2019
    ,nsc.nascidos_2020
	,nsc.nascidos_2021
    ,nsc.poder_aquisitivo_2020
	,nsc.poder_aquisitivo_2021
FROM [DadosExternos].[dbo].[IBGE_StgGeografia] dg
LEFT JOIN [SenacDW_Stg].[dbo].D_UnidadesPolos du ON dg.COD_MUNICIPIO_IBGE = du.[CODIGOIBGE]
LEFT JOIN #temp_cidades_sesc ts ON dg.COD_MUNICIPIO_IBGE = ts.COD_MUNICIPIO_IBGE
LEFT JOIN #temp_nascidos_municipio nsc on dg.COD_MUNICIPIO_IBGE = nsc.cod_municipio_ibge

-- limpeza de memória dropando as tabelas temporárias
DROP TABLE #temp_cidades_sesc;
DROP TABLE #temp_nascidos_municipio;